ylb = "YLD per 100,000",
zlb = NULL,
colset =  colset)+
labs(title="YLD rate for CVD, Neoplasm, Mental Disease (crude)")
CG2_yld
df3o$cr_yllr <- 0
df3o$st_yllr <- 0
df3o$cr_dalyr <- cr_yldr
df3o$st_dalyr <- st_yldr
df3o <- read.csv("dat/B06.csv", stringsAsFactors = F)
csnm <- c("1"="MDD", "2"="Dyhtymia",
"3"="Bipolar", "3.1"="Bipolar", "3.2"="Bipolar",
"4"="Anxiety", "5"="Anorexia", "6"="Bullimia")
df3o$name <- csnm[as.character(df3o$disease)]
df3o <- df3o[,c(2,10,1,7,8)]
colnames(df3o) <- c("cs_id", "cs_name","year", "cr_yldr", "st_yldr")
df3o$cr_yllr <- 0
df3o$st_yllr <- 0
df3o$cr_dalyr <- df3o$cr_yldr
df3o$st_dalyr <- df3o$st_yldr
####
gen_colset <- function(z, zc=NULL){
if(is.null(zc)) zc <- rep(1, length(z))
d <- data.frame(z, zc)
d <- d[!duplicated(d),]
z <- as.character(d$z)
zc <- as.character(d$zc)
nc <- length(unique(zc))
if(nc > 8) stop("too many z classes.")
nc_z<-tapply(z, zc, length)
cls <-c(
colorRampPalette(c("#bb1142","#f8b0bf","#E45328"))(9),
colorRampPalette(c("#854a00","#ffb700","#ffe0a7"))(8),
colorRampPalette(c("#006600","#A1E8A1","#395dbd"))(9),
colorRampPalette(c("#704270","#e2e0e8"))(6)
#colorRampPalette(c("#3C3549","#7D7098","#C6C0D2"))(10)
)
#plot(1:length(tmp), 1:length(tmp), col=tmp, pch=16,cex=4)
# cls <- c("#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E",
#   "#E6AB02","#A6761D","#666666")[1:nc]
# v <- unname(
#   sapply(cls, function(x) colorRampPalette(c("#000000",x))(12)[10] ))
#out <- lapply(1:nc, function(x) colorRampPalette(c(cls[x],"#FFFFFF"))(nc_z[x]+2)[1:nc_z[x]] )
#out <- do.call(c, out)
names(cls) <- d$z
cls
}
f2 <- function(df,xs="year" ,ys="Crude_DALY", zs="name",
xlb = "year", ylb="DALY per 100,000", zlb="Disease",
colset=NULL){
df <- df[, c(xs, ys, zs)]
if(is.null(colset)) colset<-gen_colset(z = sort(unique(df[,zs])),zc = NULL)
df[,zs] <- factor(as.character(df[,zs]), levels = (names(colset)))
ggplot(df)+
geom_bar(aes(x=as.factor(get(xs)), y= get(ys), fill=get(zs)),
stat="identity")+
scale_fill_manual(values = colset, name=zlb)+
guides(fill = guide_legend(ncol=7))+
labs(x=xlb, y=ylb)+
theme(legend.position = "bottom")
}
p3 <- df3o[,c("cs_name", "year","cr_dalyr", "st_dalyr")]
p3$zc <- 3
p1 <- df1o[,c("cs_name", "year","cr_dalyr", "st_dalyr")]
p1$zc <- 1
p2 <- df2o[,c("cs_name", "year","cr_dalyr", "st_dalyr")]
p2$zc <- 2
gdf <- rbind(p1,p2,p3)
gdf <- gdf[gdf$year>2000 & gdf$year<2017 ,]
gdf$year <- factor(gdf$year)
####
colset <- gen_colset (z = gdf$cs_name, zc = gdf$zc)
gen_colset <- function(z, zc=NULL){
if(is.null(zc)) zc <- rep(1, length(z))
d <- data.frame(z, zc)
d <- d[!duplicated(d),]
z <- as.character(d$z)
zc <- as.character(d$zc)
nc <- length(unique(zc))
if(nc > 8) stop("too many z classes.")
nc_z<-tapply(z, zc, length)
cls <-c(
colorRampPalette(c("#bb1142","#f8b0bf","#E45328"))(9),
colorRampPalette(c("#854a00","#ffb700","#ffe0a7"))(8),
colorRampPalette(c("#006600","#A1E8A1","#395dbd"))(9),
colorRampPalette(c("#704270","#e2e0e8"))(6)
#colorRampPalette(c("#3C3549","#7D7098","#C6C0D2"))(10)
)
#plot(1:length(tmp), 1:length(tmp), col=tmp, pch=16,cex=4)
# cls <- c("#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E",
#   "#E6AB02","#A6761D","#666666")[1:nc]
# v <- unname(
#   sapply(cls, function(x) colorRampPalette(c("#000000",x))(12)[10] ))
#out <- lapply(1:nc, function(x) colorRampPalette(c(cls[x],"#FFFFFF"))(nc_z[x]+2)[1:nc_z[x]] )
#out <- do.call(c, out)
names(cls) <- d$z
cls
}
f2 <- function(df,xs="year" ,ys="Crude_DALY", zs="name",
xlb = "year", ylb="DALY per 100,000", zlb="Disease",
colset=NULL){
df <- df[, c(xs, ys, zs)]
if(is.null(colset)) colset<-gen_colset(z = sort(unique(df[,zs])),zc = NULL)
df[,zs] <- factor(as.character(df[,zs]), levels = (names(colset)))
ggplot(df)+
geom_bar(aes(x=as.factor(get(xs)), y= get(ys), fill=get(zs)),
stat="identity")+
scale_fill_manual(values = colset, name=zlb)+
guides(fill = guide_legend(ncol=7))+
labs(x=xlb, y=ylb)+
theme(legend.position = "bottom")
}
p3 <- df3o[,c("cs_name", "year","cr_dalyr", "st_dalyr")]
p3$zc <- 3
p1 <- df1o[,c("cs_name", "year","cr_dalyr", "st_dalyr")]
p1$zc <- 1
p2 <- df2o[,c("cs_name", "year","cr_dalyr", "st_dalyr")]
p2$zc <- 2
gdf <- rbind(p1,p2,p3)
gdf <- gdf[gdf$year>2000 & gdf$year<2017 ,]
gdf$year <- factor(gdf$year)
####
colset <- gen_colset (z = gdf$cs_name, zc = gdf$zc)
f2(gdf,xs="year" ,ys="cr_dalyr", zs="cs_name",
ylb = "YLD per 100,000",
zlb = NULL,
colset =  colset)+
labs(title="DALY rate for CVD, Neoplasm, Mental Disease (crude)")
####
gen_colset <- function(z, zc=NULL){
if(is.null(zc)) zc <- rep(1, length(z))
d <- data.frame(z, zc)
d <- d[!duplicated(d),]
z <- as.character(d$z)
zc <- as.character(d$zc)
nc <- length(unique(zc))
if(nc > 8) stop("too many z classes.")
nc_z<-tapply(z, zc, length)
cls <-c(
colorRampPalette(c("#bb1142","#f8b0bf","#E45328"))(9),
colorRampPalette(c("#854a00","#ffb700","#ffe0a7"))(8),
colorRampPalette(c("#006600","#A1E8A1","#395dbd"))(9),
colorRampPalette(c("#704270","#e2e0e8"))(6)
#colorRampPalette(c("#3C3549","#7D7098","#C6C0D2"))(10)
)
#plot(1:length(tmp), 1:length(tmp), col=tmp, pch=16,cex=4)
# cls <- c("#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E",
#   "#E6AB02","#A6761D","#666666")[1:nc]
# v <- unname(
#   sapply(cls, function(x) colorRampPalette(c("#000000",x))(12)[10] ))
#out <- lapply(1:nc, function(x) colorRampPalette(c(cls[x],"#FFFFFF"))(nc_z[x]+2)[1:nc_z[x]] )
#out <- do.call(c, out)
names(cls) <- d$z
cls
}
f2 <- function(df,xs="year" ,ys="Crude_DALY", zs="name",
xlb = "year", ylb="DALY per 100,000", zlb="Disease",
colset=NULL){
df <- df[, c(xs, ys, zs)]
if(is.null(colset)) colset<-gen_colset(z = sort(unique(df[,zs])),zc = NULL)
df[,zs] <- factor(as.character(df[,zs]), levels = (names(colset)))
ggplot(df)+
geom_bar(aes(x=as.factor(get(xs)), y= get(ys), fill=get(zs)),
stat="identity")+
scale_fill_manual(values = colset, name=zlb)+
guides(fill = guide_legend(ncol=7))+
labs(x=xlb, y=ylb)+
theme(legend.position = "bottom")
}
p3 <- df3o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p3$zc <- 3
p1 <- df1o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p1$zc <- 1
p2 <- df2o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p2$zc <- 2
gdf <- rbind(p1,p2,p3)
gdf <- gdf[gdf$year>2000 & gdf$year<2017 ,]
gdf$year <- factor(gdf$year)
####
colset <- gen_colset (z = gdf$cs_name, zc = gdf$zc)
CG2_yld <- f2(gdf,xs="year" ,ys="cr_dalyr", zs="cs_name",
ylb = "YLD per 100,000",
zlb = NULL,
colset =  colset)+
labs(title="DALY rate for CVD, Neoplasm, Mental Disease (crude)")
ggsave(plot = CG2_yld, filename = "Fig1_DALY_crude_since2000.jpeg",
width = 18, height = 12,units="cm", scale = 2.5)
CG2_yld <- f2(gdf,xs="year" ,ys="st_dalyr", zs="cs_name",
ylb = "YLD per 100,000",
zlb = NULL,
colset =  colset)+
labs(title="DALY rate for CVD, Neoplasm, Mental Disease (age-standardized)")
ggsave(plot = CG2_yld, filename = "Fig2_DALY_astd_since2000.jpeg",
width = 18, height = 12,units="cm", scale = 2.5)
gen_colset <- function(z, zc=NULL){
if(is.null(zc)) zc <- rep(1, length(z))
d <- data.frame(z, zc)
d <- d[!duplicated(d),]
z <- as.character(d$z)
zc <- as.character(d$zc)
nc <- length(unique(zc))
if(nc > 8) stop("too many z classes.")
nc_z<-tapply(z, zc, length)
cls <-c(
colorRampPalette(c("#bb1142","#f8b0bf","#E45328"))(9),
colorRampPalette(c("#854a00","#ffb700","#ffe0a7"))(8),
colorRampPalette(c("#006600","#A1E8A1","#395dbd"))(9),
colorRampPalette(c("#704270","#e2e0e8"))(6)
#colorRampPalette(c("#3C3549","#7D7098","#C6C0D2"))(10)
)
#plot(1:length(tmp), 1:length(tmp), col=tmp, pch=16,cex=4)
# cls <- c("#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E",
#   "#E6AB02","#A6761D","#666666")[1:nc]
# v <- unname(
#   sapply(cls, function(x) colorRampPalette(c("#000000",x))(12)[10] ))
#out <- lapply(1:nc, function(x) colorRampPalette(c(cls[x],"#FFFFFF"))(nc_z[x]+2)[1:nc_z[x]] )
#out <- do.call(c, out)
names(cls) <- d$z
cls
}
f2 <- function(df,xs="year" ,ys="Crude_DALY", zs="name",
xlb = "year", ylb="DALY per 100,000", zlb="Disease",
colset=NULL){
df <- df[, c(xs, ys, zs)]
if(is.null(colset)) colset<-gen_colset(z = sort(unique(df[,zs])),zc = NULL)
df[,zs] <- factor(as.character(df[,zs]), levels = (names(colset)))
ggplot(df)+
geom_bar(aes(x=as.factor(get(xs)), y= get(ys), fill=get(zs)),
stat="identity")+
scale_fill_manual(values = colset, name=zlb)+
guides(fill = guide_legend(ncol=7))+
labs(x=xlb, y=ylb)+
theme(legend.position = "bottom")
}
p3 <- df3o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p3$zc <- 3
p1 <- df1o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p1$zc <- 1
p2 <- df2o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p2$zc <- 2
gdf <- rbind(p1,p2,p3)
gdf <- gdf[gdf$year>2000 & gdf$year<2017 ,]
gdf$year <- factor(gdf$year)
####
colset <- gen_colset (z = gdf$cs_name, zc = gdf$zc)
CG <- f2(gdf,xs="year" ,ys="cr_dalyr", zs="cs_name",
ylb = "DALY per 100,000",
zlb = NULL,
colset =  colset)+
labs(title="DALY rate for CVD, Neoplasm, Mental Disease (crude)")
ggsave(plot = CG, filename = "Fig1_DALY_crude_since2000.jpeg",
width = 18, height = 12,units="cm", scale = 2.5)
CG <- f2(gdf,xs="year" ,ys="st_dalyr", zs="cs_name",
ylb = "DALY per 100,000",
zlb = NULL,
colset =  colset)+
labs(title="DALY rate for CVD, Neoplasm, Mental Disease (age-standardized)")
ggsave(plot = CG, filename = "Fig2_DALY_astd_since2000.jpeg",
width = 18, height = 12,units="cm", scale = 2.5)
CG <- f2(gdf,xs="year" ,ys="cr_yldr", zs="cs_name",
ylb = "YLD per 100,000",
zlb = NULL,
colset =  colset)+
labs(title="YLD rate for CVD, Neoplasm, Mental Disease (crude)")
ggsave(plot = CG, filename = "Fig1_YLD_crude_since2000.jpeg",
width = 18, height = 12,units="cm", scale = 2.5)
CG <- f2(gdf,xs="year" ,ys="st_yldr", zs="cs_name",
ylb = "YLD per 100,000",
zlb = NULL,
colset =  colset)+
labs(title="YLD rate for CVD, Neoplasm, Mental Disease (age-standardized)")
ggsave(plot = CG, filename = "Fig2_YLD_astd_since2000.jpeg",
width = 18, height = 12,units="cm", scale = 2.5)
####
gen_colset <- function(z, zc=NULL){
if(is.null(zc)) zc <- rep(1, length(z))
d <- data.frame(z, zc)
d <- d[!duplicated(d),]
z <- as.character(d$z)
zc <- as.character(d$zc)
nc <- length(unique(zc))
if(nc > 8) stop("too many z classes.")
nc_z<-tapply(z, zc, length)
cls <-c(
colorRampPalette(c("#bb1142","#f8b0bf","#E45328"))(9),
colorRampPalette(c("#854a00","#ffb700","#ffe0a7"))(8),
colorRampPalette(c("#006600","#A1E8A1","#395dbd"))(9),
colorRampPalette(c("#704270","#e2e0e8"))(6)
#colorRampPalette(c("#3C3549","#7D7098","#C6C0D2"))(10)
)
#plot(1:length(tmp), 1:length(tmp), col=tmp, pch=16,cex=4)
# cls <- c("#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E",
#   "#E6AB02","#A6761D","#666666")[1:nc]
# v <- unname(
#   sapply(cls, function(x) colorRampPalette(c("#000000",x))(12)[10] ))
#out <- lapply(1:nc, function(x) colorRampPalette(c(cls[x],"#FFFFFF"))(nc_z[x]+2)[1:nc_z[x]] )
#out <- do.call(c, out)
names(cls) <- d$z
cls
}
f2 <- function(df,xs="year" ,ys="Crude_DALY", zs="name",
xlb = "year", ylb="DALY per 100,000", zlb="Disease",
colset=NULL){
df <- df[, c(xs, ys, zs)]
if(is.null(colset)) colset<-gen_colset(z = sort(unique(df[,zs])),zc = NULL)
df[,zs] <- factor(as.character(df[,zs]), levels = (names(colset)))
ggplot(df)+
geom_bar(aes(x=as.factor(get(xs)), y= get(ys), fill=get(zs)),
stat="identity")+
scale_fill_manual(values = colset, name=zlb)+
guides(fill = guide_legend(ncol=7))+
labs(x=xlb, y=ylb)+
theme(legend.position = "bottom")
}
p3 <- df3o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p3$zc <- 3
p1 <- df1o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p1$zc <- 1
p2 <- df2o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p2$zc <- 2
gdf <- rbind(p1,p2,p3)
gdf <- gdf[gdf$year>2007 & gdf$year<2017 ,]
gdf$year <- factor(gdf$year)
####
colset <- gen_colset (z = gdf$cs_name, zc = gdf$zc)
CG <- f2(gdf,xs="year" ,ys="cr_dalyr", zs="cs_name",
ylb = "DALY per 100,000",
zlb = NULL,
colset =  colset)+
labs(title="DALY rate for CVD, Neoplasm, Mental Disease (crude)")
ggsave(plot = CG, filename = "Fig1_DALY_crude_since2008.jpeg",
width = 18, height = 12,units="cm", scale = 2.5)
CG <- f2(gdf,xs="year" ,ys="st_dalyr", zs="cs_name",
ylb = "DALY per 100,000",
zlb = NULL,
colset =  colset)+
labs(title="DALY rate for CVD, Neoplasm, Mental Disease (age-standardized)")
ggsave(plot = CG, filename = "Fig2_DALY_astd_since2008.jpeg",
width = 18, height = 12,units="cm", scale = 2.5)
CG <- f2(gdf,xs="year" ,ys="cr_yldr", zs="cs_name",
ylb = "YLD per 100,000",
zlb = NULL,
colset =  colset)+
labs(title="YLD rate for CVD, Neoplasm, Mental Disease (crude)")
ggsave(plot = CG, filename = "Fig1_YLD_crude_since2008.jpeg",
width = 18, height = 12,units="cm", scale = 2.5)
CG <- f2(gdf,xs="year" ,ys="st_yldr", zs="cs_name",
ylb = "YLD per 100,000",
zlb = NULL,
colset =  colset)+
labs(title="YLD rate for CVD, Neoplasm, Mental Disease (age-standardized)")
ggsave(plot = CG, filename = "Fig2_YLD_astd_since2008.jpeg",
width = 18, height = 12,units="cm", scale = 2.5)
setwd("C:/Users/user/Desktop/TBDvis module/obs")
library(ggplot2)
library(tidyr)
library(dplyr)
library(RColorBrewer)
theme_set(theme_classic(base_size = 18))
df1o <- read.csv("dat/B02.csv", stringsAsFactors = F)
df1o <- df1o[,c(2,3,1,8,14,17,10,16,18)]
#df1o <- df1o[df1o$year > 2007,]
colnames(df1o) <- c("cs_id","cs_name","year", "cr_yldr", "cr_yllr", "cr_dalyr",
"st_yldr", "st_yllr", "st_dalyr" )
df2o <- read.csv("dat/B01.csv", stringsAsFactors = F)
df2o <- df2o[,c(1,2,11,10,12,16,15,17)]
#df2o <- df2o[df2o$year > 2007,]
colnames(df2o) <- c("cs_name","year", "cr_yldr", "cr_yllr", "cr_dalyr",
"st_yldr", "st_yllr", "st_dalyr" )
df2o$cs_name <- stringr::str_to_sentence(df2o$cs_name)
df3o <- read.csv("dat/B06.csv", stringsAsFactors = F)
csnm <- c("1"="MDD", "2"="Dyhtymia",
"3"="Bipolar", "3.1"="Bipolar", "3.2"="Bipolar",
"4"="Anxiety", "5"="Anorexia", "6"="Bullimia")
df3o$name <- csnm[as.character(df3o$disease)]
df3o <- df3o[,c(2,10,1,7,8)]
colnames(df3o) <- c("cs_id", "cs_name","year", "cr_yldr", "st_yldr")
df3o$cr_yllr <- 0
df3o$st_yllr <- 0
df3o$cr_dalyr <- df3o$cr_yldr
df3o$st_dalyr <- df3o$st_yldr
#df3o <- df3o[df3o$year > 2007,]
if(F){
dd2 <- read.csv("dat/mental_raw.csv",stringsAsFactors = F)
dd2$name <- sapply(strsplit(dd2$name,"_"),`[[` ,1)
df3o <- aggregate(formula=yld_rate~cause_outline+year, data=dd2, FUN = sum)
colnames(df3o)[3] <- "crude_yld_rate"
pop <- dd2[,c("year", "population_sum")]
pop <- pop[!duplicated(pop),]
row.names(pop)<- pop$year
YLLpath <- "C:/Users/user/Desktop/NBD Fatal WorkSpace/YLL/"
fps <- c("Tab_ASTY96_B06_mental.csv","Tab_ASTY105_B06_mental.csv")
dd <- lapply(fps, function(x) read.csv(paste0(YLLpath,x),stringsAsFactors = F))
dd <- do.call(rbind, dd)
#dd$Causel4 <- substr(dd$Causel4,1,7)
dd <- aggregate(formula=YLL~Causel4+Year, data=dd, FUN = sum)
dd$pop <- pop[as.character(dd$Year),"population_sum"]
dd$crude_yll_rate <- 1E5*dd$YLL/dd$pop
df3o <- dplyr::left_join(df3o, dd[,c("Causel4","Year","crude_yll_rate")],
by=c("cause_outline"="Causel4", "year"="Year"))
df3o$crude_yll_rate[is.na(df3o$crude_yll_rate)]<-0
df3o$crude_daly_rate <-df3o$crude_yll_rate+df3o$crude_yld_rate
ref <- dd2[,c("cause_outline", "name")]
ref <- ref[!duplicated(ref),]
row.names(ref)<- ref$cause_outline
df3o$name  <- ref[as.character(df3o$cause_outline),"name"]
df3o[,c("st_yll_rate","st_yld_rate","st_daly_rate")] <- NA
df3o <- df3o[df3o$year > 2007,]
}
####
gen_colset <- function(z, zc=NULL){
if(is.null(zc)) zc <- rep(1, length(z))
d <- data.frame(z, zc)
d <- d[!duplicated(d),]
z <- as.character(d$z)
zc <- as.character(d$zc)
nc <- length(unique(zc))
if(nc > 8) stop("too many z classes.")
nc_z<-tapply(z, zc, length)
cls <-c(
colorRampPalette(c("#bb1142","#f8b0bf","#E45328"))(9),
colorRampPalette(c("#854a00","#ffb700","#ffe0a7"))(8),
colorRampPalette(c("#006600","#A1E8A1","#395dbd"))(9),
colorRampPalette(c("#704270","#e2e0e8"))(6)
#colorRampPalette(c("#3C3549","#7D7098","#C6C0D2"))(10)
)
#plot(1:length(tmp), 1:length(tmp), col=tmp, pch=16,cex=4)
# cls <- c("#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E",
#   "#E6AB02","#A6761D","#666666")[1:nc]
# v <- unname(
#   sapply(cls, function(x) colorRampPalette(c("#000000",x))(12)[10] ))
#out <- lapply(1:nc, function(x) colorRampPalette(c(cls[x],"#FFFFFF"))(nc_z[x]+2)[1:nc_z[x]] )
#out <- do.call(c, out)
names(cls) <- d$z
cls
}
f2 <- function(df,xs="year" ,ys="Crude_DALY", zs="name",
xlb = "year", ylb="DALY per 100,000", zlb="Disease",
colset=NULL){
df <- df[, c(xs, ys, zs)]
if(is.null(colset)) colset<-gen_colset(z = sort(unique(df[,zs])),zc = NULL)
df[,zs] <- factor(as.character(df[,zs]), levels = (names(colset)))
ggplot(df)+
geom_bar(aes(x=as.factor(get(xs)), y= get(ys), fill=get(zs)),
stat="identity")+
scale_fill_manual(values = colset, name=zlb)+
guides(fill = guide_legend(ncol=7))+
labs(x=xlb, y=ylb)+
theme(legend.position = "bottom")
}
p3 <- df3o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p3$zc <- 3
p1 <- df1o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p1$zc <- 1
p2 <- df2o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p2$zc <- 2
gdf <- rbind(p1,p2,p3)
gdf <- gdf[gdf$year>2007 & gdf$year<2017 ,]
gdf$year <- factor(gdf$year)
View(gdf)
write.csv(gdf, "other_disease_DALY_number.csv", row.names = F)
####
gen_colset <- function(z, zc=NULL){
if(is.null(zc)) zc <- rep(1, length(z))
d <- data.frame(z, zc)
d <- d[!duplicated(d),]
z <- as.character(d$z)
zc <- as.character(d$zc)
nc <- length(unique(zc))
if(nc > 8) stop("too many z classes.")
nc_z<-tapply(z, zc, length)
cls <-c(
colorRampPalette(c("#bb1142","#f8b0bf","#E45328"))(9),
colorRampPalette(c("#854a00","#ffb700","#ffe0a7"))(8),
colorRampPalette(c("#006600","#A1E8A1","#395dbd"))(9),
colorRampPalette(c("#704270","#e2e0e8"))(6)
#colorRampPalette(c("#3C3549","#7D7098","#C6C0D2"))(10)
)
#plot(1:length(tmp), 1:length(tmp), col=tmp, pch=16,cex=4)
# cls <- c("#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E",
#   "#E6AB02","#A6761D","#666666")[1:nc]
# v <- unname(
#   sapply(cls, function(x) colorRampPalette(c("#000000",x))(12)[10] ))
#out <- lapply(1:nc, function(x) colorRampPalette(c(cls[x],"#FFFFFF"))(nc_z[x]+2)[1:nc_z[x]] )
#out <- do.call(c, out)
names(cls) <- d$z
cls
}
f2 <- function(df,xs="year" ,ys="Crude_DALY", zs="name",
xlb = "year", ylb="DALY per 100,000", zlb="Disease",
colset=NULL){
df <- df[, c(xs, ys, zs)]
if(is.null(colset)) colset<-gen_colset(z = sort(unique(df[,zs])),zc = NULL)
df[,zs] <- factor(as.character(df[,zs]), levels = (names(colset)))
ggplot(df)+
geom_bar(aes(x=as.factor(get(xs)), y= get(ys), fill=get(zs)),
stat="identity")+
scale_fill_manual(values = colset, name=zlb)+
guides(fill = guide_legend(ncol=7))+
labs(x=xlb, y=ylb)+
theme(legend.position = "bottom")
}
p3 <- df3o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p3$zc <- 3
p1 <- df1o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p1$zc <- 1
p2 <- df2o[,c("cs_name", "year","cr_yldr", "st_yldr","cr_dalyr", "st_dalyr")]
p2$zc <- 2
gdf <- rbind(p1,p2,p3)
gdf <- gdf[gdf$year>2000 & gdf$year<2017 ,]
gdf$year <- factor(gdf$year)
write.csv(gdf, "other_disease_DALY_number.csv", row.names = F)
